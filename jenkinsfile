pipeline {

    agent any 

    stages {

        triggers {
            cron('H */2 * * *')
        }

        stage("Checkout") {
            steps {
                checkout scm 
            }
        }

        stage("Installing") {
            when { branch 'master' }
            steps {
                sh 'npm install'
            }
        }

        stage('Lint') {
            when { branch 'master' }
            when { expression { fileExists('eslint.config.ts') || fileExists('.eslintrc') } }
            steps {
                sh 'npm run lint'
            }
        }

        stage("Prettier") {
            when { branch 'master' }
            when { expression { fileExists('.prettierrc') } }
            steps {
                sh 'npm run format'
            }
        }

        stage("Testing") {
            when { branch 'master' }
            steps {
                sh 'npm test'
            }
        }

        stage('Build') {
            when { branch 'master' }
            steps {
                sh 'npm run build'
            }
        }

        post {
            always {
                junit testResults: 'reports/junit/**/*.xml', allowEmptyResults: true
            }
        } 
    }
}